# Verify Protocol

구현 완료 후 SPEC 대비 검증. 서브에이전트가 코드베이스를 탐색하여 명세 충족 여부 확인.

## 트리거

gepetto resume 시 모든 계획 파일이 존재하고 사용자가 "구현 완료" 또는 "--verify" 전달 시.

## 검증 프로세스

### Step 18: 서브에이전트 검증 실행

Task(subagent_type="Explore") 2개 병렬 실행:

1. **기능 검증 에이전트**: claude-spec.md의 기능적 요구사항 vs 실제 코드
   - 각 요구사항별 구현 여부 (✅/❌)
   - 누락된 기능 구체적 명시
   - 엣지 케이스 처리 확인

2. **품질 검증 에이전트**: 비기능 요구사항 + 코드 품질
   - 성능/보안/접근성 요구사항 충족 여부
   - 테스트 커버리지
   - 타입 안전성
   - 문서화 상태

```
# 두 에이전트를 하나의 메시지에서 병렬 실행:

Task(
  subagent_type="Explore",
  prompt="""
  기능 검증: claude-spec.md 대비 구현 상태 확인

  1. <planning_dir>/claude-spec.md를 읽고 기능적 요구사항 목록 추출
  2. 코드베이스에서 각 요구사항의 구현 여부 확인
  3. 결과를 다음 형식으로 반환:

  ## 기능 검증 결과
  | 요구사항 | 상태 | 근거 |
  |----------|------|------|
  | ... | ✅/❌ | 파일:라인 또는 미구현 사유 |

  - 엣지 케이스 처리 여부도 확인
  - 누락된 기능은 구체적으로 명시
  """
)

Task(
  subagent_type="Explore",
  prompt="""
  품질 검증: 비기능 요구사항 + 코드 품질 확인

  1. <planning_dir>/claude-spec.md에서 비기능 요구사항 추출
  2. 코드베이스에서 다음 항목 확인:
     - 성능/보안/접근성 요구사항 충족 여부
     - 테스트 커버리지 (테스트 파일 존재 여부)
     - 타입 안전성 (any 사용, 타입 누락)
     - 문서화 상태 (README, JSDoc 등)

  ## 품질 검증 결과
  | 항목 | 상태 | 상세 |
  |------|------|------|
  | ... | ✅/❌ | ... |
  """
)
```

두 에이전트의 결과를 합쳐 `<planning_dir>/claude-verify-report.md`로 작성.

### Step 19: 검증 결과 보고

사용자에게 결과 제시:
- 전체 충족률 (%)
- 카테고리별 상세 (기능/품질)
- 누락 항목 목록

AskUserQuestion으로 다음 선택:
- "수정 후 재검증" → Step 18 반복
- "현재 상태 승인" → 완료

```
AskUserQuestion:
  question: "검증 결과를 확인했습니다. 어떻게 하시겠습니까?"
  options:
    - "수정 후 재검증" (누락 항목 수정 후 Step 18 재실행)
    - "현재 상태 승인" (검증 완료, 종료)
```
