## 응답 키워드 규칙

**대부분의 응답에 키워드 블록을 포함하세요.**
설명, 질문 답변, 토론 등도 나중에 검색할 수 있도록 태그를 답니다.
Stop 훅이 응답 텍스트를 자동 저장하므로, 키워드도 함께 캡처됩니다.

**형식 (응답 끝에 추가):**
```
`#tags: keyword1, keyword2, keyword3`
```

**예시:**
```
파일을 수정했습니다. orchestrator 설치 스크립트가 완성되었습니다.

`#tags: orchestrator, install-script, mcp, hooks`
```

**키워드 추출 대상:**
- 기술 스택: react, typescript, spring, docker, mcp 등
- 작업 유형: refactoring, bug-fix, feature, setup, 설명, 질문답변 등
- 기능/모듈명: orchestrator, hooks, memory, authentication 등
- 주요 파일명: install-orchestrator.js, save-response.ps1 등
- 토론 주제: 아키텍처, 설계결정, 트레이드오프 등

**태그 기준:**
| 상황 | 태그 |
|------|------|
| 코드/파일 수정 | O |
| 설정 변경 | O |
| 기술적 설명/정보 제공 | O |
| 질문 답변/토론 | O |
| 커밋/푸시 | O |
| 단순 인사 ("안녕", "고마워") | X |

**형식 규칙:**
- 소문자, 하이픈(-) 사용
- 한국어 키워드도 허용
- 3~7개 범위로 유지

## 과거 대화 검색 규칙

사용자가 과거 작업을 언급하면 (예: "이전에 ~했었지?", "그때 ~ 어떻게 했더라?"),
대화 기록에서 관련 내용을 검색하여 답변에 활용하세요.

**검색 순서:**
1. MEMORY.md 키워드 인덱스에서 관련 섹션 확인 (이미 로드됨)
2. 질문에서 핵심 키워드 추출 + **동의어/관련어 확장**
   - 예: "병렬 작업" → `parallel`, `orchestrator`, `pm-worker`, `병렬`, `concurrent`
   - 예: "속도 문제" → `performance`, `speed`, `느림`, `최적화`, `optimization`
   - 한국어 ↔ 영어 양방향 확장 필수
3. 확장된 키워드로 대화 파일 검색 (여러 번 grep):
   - `grep -r "#tags:.*키워드1" conversations/`
   - `grep -r "#tags:.*키워드2" conversations/`
   - 첫 grep에서 못 찾으면 동의어로 재시도, 최대 3회
4. 매칭된 대화 파일의 해당 섹션(전후 문맥) 읽기
5. 관련 키워드가 추가로 발견되면 **하위 탐색** (1회 더 grep)

**검색 트리거 (이런 표현이 나오면 검색):**
- "이전에", "그때", "전에", "예전에", "저번에"
- "했었지?", "했었는데", "어떻게 했더라"
- "다시", "또", "같은 방식으로"
- 구체적 키워드 언급 (orchestrator, hooks 등)

**응답 방식:**
- 찾았으면: 관련 대화 날짜와 핵심 내용을 인용하며 답변
- 못 찾았으면: "관련 기록을 찾지 못했습니다"라고 솔직히 답변

## MEMORY.md 관리 규칙

MEMORY.md는 프로젝트 루트에 위치한 **컨텍스트 트리 구조** 장기기억 파일입니다.
중요한 설계 결정, 패턴, 주의사항이 발생하면 적절한 섹션에 추가하세요.

**섹션 구조:**

| 섹션 | 내용 |
|------|------|
| `architecture/` | 설계 결정, 아키텍처 선택 |
| `patterns/` | 작업 패턴, 워크플로우 |
| `tools/` | 외부 도구, 라이브러리 |
| `gotchas/` | 주의사항, 함정 |

**항목 형식:**
```markdown
### 항목명
`tags: keyword1, keyword2, keyword3`
`date: YYYY-MM-DD`
`source: claude`

- 핵심 내용 (간결하게)
- **참조**: [대화 링크](conversations/YYYY-MM-DD.md)
```

> `source`는 이 항목을 작성한 CLI를 표시합니다 (claude, codex, gemini).
> 과거 대화 검색 시 해당 CLI의 대화 폴더에서 찾습니다.

**규칙:**
- 새 항목 추가 시 **키워드 인덱스 테이블**도 업데이트
- 이미 기록된 내용은 중복 추가하지 않음
- 대화 참조 링크 포함

**결정 변경 시 (Superseded 패턴):**
- 기존 항목 삭제 금지 (이력 보존)
- 기존 항목에 `❌ SUPERSEDED` + `superseded-by: #새항목` 추가
- 새 항목에 `✅ CURRENT` + `supersedes: #기존항목` + 변경 이유 포함

**기록 트리거:**
- 새로운 아키텍처/설계 결정이 내려졌을 때
- 중요한 버그 해결 방법을 발견했을 때
- 반복 가능한 워크플로우 패턴이 확립되었을 때
- 주의해야 할 함정(gotcha)을 발견했을 때
